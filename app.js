document.addEventListener("DOMContentLoaded", () => {
    const messagesContainer = document.querySelector("#messages-container");
    const sendButton = document.querySelector("#send-btn");
    const messageInput = document.querySelector("#message-input");
    const clearHistoryBtn = document.querySelector("#clear-btn");

    // –ë–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–æ–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ—Ç–≤–µ—Ç
    let sendingInProgress = false;

    // –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
    function addMessage(text, isUser) {
        let messageClass = isUser ? "user-message" : "bot-message";
        const messageItem = `
            <div class="message-item ${messageClass}">
                ${text}
            </div>
        `;
        messagesContainer.insertAdjacentHTML("beforeend", messageItem);
        messagesContainer.scrollTo({ top: messagesContainer.scrollHeight });
    }

    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
    const botResponses = [
        ["–ü—Ä–∏–≤–µ—Ç", "–ü—Ä–∏–≤–µ—Ç! –†–∞–¥–∞ –Ω–∞—à–µ–π –±–µ—Å–µ–¥–µ!"],                     // –ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
        ["–ü—Ä–∏–≤–µ—Ç –∫–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞", "–í—Å—ë –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ! –í—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–±—è!"],
        ["–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç", "–ú–µ–Ω—è –∑–æ–≤—É—Ç Violet Bot. –ê –∫–∞–∫ –∑–≤–∞—Ç—å —Ç–µ–±—è?"],              // –ë–µ–∑ —Ç–æ—á–∫–∏
        ["–ö–∞–∫–æ–π —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å", "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å –æ—Å–æ–±–µ–Ω–Ω—ã–π ‚Äî –ø–æ–ª—å–∑—É–π—Å—è –º–æ–º–µ–Ω—Ç–æ–º!"],
        ["–ü–æ–¥–µ–ª–∏—Å—å —Ä–µ—Ü–µ–ø—Ç–æ–º –≤–∫—É—Å–Ω–æ–≥–æ –±–ª—é–¥–∞", "–ü—Ä–µ–¥–ª–∞–≥–∞—é –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –º–∞–∫–∞—Ä–æ–Ω—ã —Å —Å—ã—Ä–æ–º ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –≤–∫—É—Å–Ω–æ!"],
        ["–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç", "–ü–æ—á–µ–º—É —É—Ç–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–∞–¥—è—Ç—Å—è –Ω–∞ –ª–∞–≤–æ—á–∫–∏? –ë–æ—è—Ç—Å—è —Å–µ—Å—Ç—å –Ω–∞ —á—É–∂—É—é –ª—É–∂—É! üòÉ"],
        ["–ö–∞–∫–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ —É—á–µ–±–µ", "–û—Ä–≥–∞–Ω–∏–∑—É–π —Ä–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–∞–π–º–µ—Ä –∏ –æ—Ç–¥—ã—Ö–∞–π –º–µ–∂–¥—É –∑–∞–Ω—è—Ç–∏—è–º–∏!"],
        ["–ß—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—à—å –ø–æ—Å–ª—É—à–∞—Ç—å", "–†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ—Å–ª—É—à–∞—Ç—å –∞–ª—å–±–æ–º \"OK Computer\" –≥—Ä—É–ø–ø—ã Radiohead ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π —à–µ–¥–µ–≤—Ä!"],
        ["–ß—Ç–æ –¥—É–º–∞–µ—à—å –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö", "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã –∏ –¥–∞—Ä—è—Ç –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è! –ö—É–¥–∞ —Ö–æ—á–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è —Ç–µ–±–µ?"],    
        ["–ö–∞–∫–æ–π —Å–ø–æ—Ä—Ç –ø–æ–ª–µ–∑–µ–Ω", "–ô–æ–≥–∞ —É–∫—Ä–µ–ø–ª—è–µ—Ç —Ç–µ–ª–æ –∏ —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç —É–º. –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–Ω—è!"],
        ["–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", "–°–∫—Ä–∏–ø–∫–∞ –∑–∞–≤–æ—Ä–∞–∂–∏–≤–∞–µ—Ç —Å–≤–æ–µ–π –º–µ–ª–æ–¥–∏—á–Ω–æ—Å—Ç—å—é –∏ –≥–ª—É–±–∏–Ω–æ–π –∑–≤—É—á–∞–Ω–∏—è. –ê —É —Ç–µ–±—è –∫–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç –≤–æ—Å—Ç–æ—Ä–≥?"],    
        ["–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π —Å–µ—Ä–∏–∞–ª", "‚Äû–ò–≥—Ä–∞ –ø—Ä–µ—Å—Ç–æ–ª–æ–≤‚Äú –∑–∞—Ç—è–≥–∏–≤–∞–µ—Ç –∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–º–∏ —Å—é–∂–µ—Ç–∞–º–∏ –∏ –º–∞—Å—à—Ç–∞–±–Ω—ã–º–∏ –±–∞—Ç–∞–ª–∏—è–º–∏!"],
        ["–ö–∞–∫–æ–π –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± —Ä–∞–∑–≤–∏—Ç–∏—è –º–æ–∑–≥–∞", "–†–µ—à–µ–Ω–∏–µ –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–æ–≤, –∏–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ –∏ –ø—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ ‚Äî –æ—Ç–ª–∏—á–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —É–º–∞!"],
        ["–ß—Ç–æ –ø–æ–¥–∞—Ä–∏—Ç—å –¥—Ä—É–≥—É", "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –ø–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—é ‚Äî —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥–∞—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–µ—Å–µ—Ç —Ä–∞–¥–æ—Å—Ç—å!"],
        ["–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π –≥–æ—Ä–æ–¥", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –ø–æ—Ä–∞–∂–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –∫—É–ª—å—Ç—É—Ä–æ–π. –ê –∫–∞–∫–æ–π –≥–æ—Ä–æ–¥ –±–ª–∏–∑–æ–∫ —Ç–≤–æ–µ–º—É —Å–µ—Ä–¥—Ü—É?"],     
        ["–ß—Ç–æ —Å–∫–∞–∂–µ—à—å –æ –∑–¥–æ—Ä–æ–≤—å–µ", "–°–ª–µ–¥–∏ –∑–∞ –ø–∏—Ç–∞–Ω–∏–µ–º, –¥–≤–∏–≥–∞–π—Å—è —á–∞—â–µ –∏ —É–ª—ã–±–∞–π—Å—è ‚Äî –∑–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤!"],
        ["–ö–∞–∫–æ–π –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –µ–¥—ã", "–ì–æ—Ç–æ–≤—å –¥–æ–º–∞ ‚Äî —Å–≤–µ–∂–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ –ª—é–±–æ–≤—å –¥–µ–ª–∞—é—Ç –µ–¥—É –≤–∫—É—Å–Ω–µ–π—à–µ–π!"],
        ["–ö–∞–∫–æ–π —Ç–≤–æ–π –ª—é–±–∏–º—ã–π –¥–µ—Å–µ—Ä—Ç", "–®–æ–∫–æ–ª–∞–¥–Ω—ã–π —Ç–æ—Ä—Ç —Å –∫—Ä–µ–º–æ–º ‚Äî —Ä–æ—Å–∫–æ—à—å, —Ç–∞—è—â–∞—è –≤–æ —Ä—Ç—É!"],
        ["–ö–∞–∫–æ–π —Å–µ–∫—Ä–µ—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è", "–ò—â–∏ –æ–±—â–∏–π —è–∑—ã–∫, —É–≤–∞–∂–∞–π –º–Ω–µ–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ –ø—Ä–æ—è–≤–ª—è–π –∏–Ω—Ç–µ—Ä–µ—Å ‚Äî –∑–∞–ª–æ–≥ –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã—Ö –≤–∑–∞–∏–º–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–π!"],
        ["–ß—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—à—å –≤—ã–ø–∏—Ç—å —É—Ç—Ä–æ–º", "–°–≤–µ–∂–µ–≤—ã–∂–∞—Ç—ã–π –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π —Å–æ–∫ –∏–ª–∏ –∑–µ–ª–µ–Ω—ã–π —á–∞–π ‚Äî —Ö–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± –Ω–∞—á–∞—Ç—å –¥–µ–Ω—å –±–æ–¥—Ä–æ!"]
    ];

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞
    function generateBotReply(userMessage) {
        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É)
        const normalizedMessage = userMessage.replace(/[^a-z–∞-—è—ë\s]+/gi, '').trim().toLowerCase();

        for(const [question, answer] of botResponses) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤ –±–∞–∑—ã –≤–æ–ø—Ä–æ—Å–æ–≤
            if (normalizedMessage.includes(question.toLowerCase())) {
                return answer;
            }
        }
        return "–û–π, –∫–∞–∂–µ—Ç—Å—è, —è –Ω–µ –ø–æ–Ω—è–ª–∞ –≤–æ–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞!";
    }

    // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞
    function handleSendMessage() {
        const userText = messageInput.value.trim();
        if (!userText || sendingInProgress) return;

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        sendingInProgress = true;

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        addMessage(userText, true);
        messageInput.value = '';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
        showTypingIndicator();

        // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
        setTimeout(() => {
            hideTypingIndicator();
            const botResponse = generateBotReply(userText);
            addMessage(botResponse, false);
            sendingInProgress = false;
        }, 1500); // –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ (1.5 —Å–µ–∫—É–Ω–¥—ã)
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç..."
    function showTypingIndicator() {
        const indicator = `<div class="typing-indicator">Bot –ø–µ—á–∞—Ç–∞–µ—Ç...</div>`;
        messagesContainer.insertAdjacentHTML("beforeend", indicator);
        messagesContainer.scrollTo({ top: messagesContainer.scrollHeight });
    }

    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
    function hideTypingIndicator() {
        const typingIndicator = document.querySelector(".typing-indicator");
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
    sendButton.addEventListener('click', handleSendMessage);
    messageInput.addEventListener('keyup', (event) => {
        if (event.key === 'Enter') {
            handleSendMessage();
        }
    });
    clearHistoryBtn.addEventListener('click', () => {
        messagesContainer.innerHTML = '';
    });
});
